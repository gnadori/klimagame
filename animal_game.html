<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Animal Climate and Continent Game - Final Edition!</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Montserrat', sans-serif;
            text-align: center;
            transition: background 1s ease-in-out;
            color: #fff;
        }
        #game-container {
            max-width: 500px;
            margin: 50px auto;
            padding: 20px;
            background-color: rgba(0, 0, 0, 0.4);
            border-radius: 20px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            backdrop-filter: blur(10px);
        }
        h1 {
            font-family: 'Fredoka One', cursive;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        img {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease-in-out;
        }
        img:hover {
            transform: scale(1.05);
        }
        .dropdowns {
            margin-top: 20px;
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        select, button {
            padding: 12px 20px;
            font-size: 16px;
            margin: 5px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        select {
            background-color: rgba(255, 255, 255, 0.8);
        }
        button {
            background-image: linear-gradient(45deg, #ff8a00, #e52e71);
            color: white;
            font-weight: bold;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        button:hover {
            transform: translateY(-2px) scale(1.05);
        }
        #feedback {
            margin-top: 20px;
            font-weight: bold;
            font-size: 1.2em;
            height: 30px;
            animation: fadeIn 0.5s ease-in-out;
        }
        #score, #timer {
            font-size: 24px;
            font-weight: bold;
            margin: 10px 0;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
        }
        #timer {
            color: #fff;
        }
        .progress-bar {
            width: 100%;
            background-color: rgba(0, 0, 0, 0.2);
            border-radius: 10px;
            overflow: hidden;
            margin-top: 10px;
        }
        .progress {
            height: 10px;
            width: 100%;
            background-image: linear-gradient(45deg, #ff8a00, #e52e71);
            transition: width 1s linear;
        }
        .animal-image-container {
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .animal-image-container.visible {
            opacity: 1;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body>

<div id="game-container">
    <h1>Guess the Animal's Climate and Continent!</h1>
    <div id="score">Score: 0</div>
    <div id="timer">Time left: 20</div>
    <div class="progress-bar">
        <div class="progress" id="progress"></div>
    </div>
    <div class="animal-image-container" id="animal-image-container">
        <img id="animal-image" src="" alt="Animal Image">
    </div>
    <div class="dropdowns">
        <select id="climate-select">
            <option value="">Select Climate</option>
            <option value="Egyenl√≠t≈ëi">Egyenl√≠t≈ëi</option><option value="Sarkk√∂ri">Sarkk√∂ri</option><option value="Sz√°raz kontinent√°lis">Sz√°raz kontinent√°lis</option><option value="Szubtr√≥pusi">Szubtr√≥pusi</option><option value="Tr√≥pusi monszun">Tr√≥pusi monszun</option><option value="√Åtmeneti">√Åtmeneti</option><option value="√Åtmenetei">√Åtmenetei</option>
        </select>
        <select id="continent-select">
            <option value="">Select Continent</option>
            <option value="Afrika">Afrika</option><option value="Ausztr√°lia">Ausztr√°lia</option><option value="D√©l-Amerika">D√©l-Amerika</option><option value="Eur√≥pa">Eur√≥pa</option><option value="√Åzsia">√Åzsia</option><option value="√âszak-Amerika">√âszak-Amerika</option>
        </select>
    </div>
    <button id="check-btn">Check Answer</button>
    <button id="next-btn" style="display: none;">Next Animal</button>
    <div id="feedback"></div>
</div>

<script>
    // Az adatok t√°rol√°s√°ra szolg√°l√≥ v√°ltoz√≥, amit a CSV-b≈ël t√∂lt√ºnk fel
    let gameData = [];
    let availableAnimals = [];
    let currentAnimal;
    let score = 0;
    let timer;
    let timeLeft = 20;

    // DOM elemek kiv√°laszt√°sa (ez nem v√°ltozott)
    const animalImageContainer = document.getElementById('animal-image-container');
    const animalImage = document.getElementById('animal-image');
    const climateSelect = document.getElementById('climate-select');
    const continentSelect = document.getElementById('continent-select');
    const checkBtn = document.getElementById('check-btn');
    const nextBtn = document.getElementById('next-btn');
    const feedback = document.getElementById('feedback');
    const scoreDisplay = document.getElementById('score');
    const timerDisplay = document.getElementById('timer');
    const progress = document.getElementById('progress');

    // A h√°tt√©rsz√≠nek objektuma (ez sem v√°ltozott)
    const continentColors = {
        'Ausztr√°lia': 'linear-gradient(135deg, #f7b733, #fc4a1a)',
        '√Åzsia': 'linear-gradient(135deg, #6a11cb, #2575fc)',
        'D√©l-Amerika': 'linear-gradient(135deg, #00b09b, #96c93d)',
        'Afrika': 'linear-gradient(135deg, #ff7e5f, #feb47b)',
        '√âszak-Amerika': 'linear-gradient(135deg, #43cea2, #185a9d)',
        'Eur√≥pa': 'linear-gradient(135deg, #ba5370, #f4e2d8)'
    };

    function setBackground(continent) {
        document.body.style.background = continentColors[continent.split(', ')[0]] || 'linear-gradient(135deg, #757f9a, #d7dde8)';
    }

    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
    }

    function loadAnimal() {
        if (availableAnimals.length === 0) {
            feedback.textContent = "You've guessed all the animals!";
            checkBtn.style.display = 'none';
            nextBtn.style.display = 'none';
            clearInterval(timer); // Le√°ll√≠tja az utols√≥ id≈ëz√≠t≈ët is
            return;
        }
        animalImageContainer.classList.remove('visible');
        setTimeout(() => {
            const animalIndex = Math.floor(Math.random() * availableAnimals.length);
            currentAnimal = availableAnimals.splice(animalIndex, 1)[0];
            
            animalImage.src = currentAnimal['Filen√©v'];
            setBackground(currentAnimal['Kontinens']);
            feedback.textContent = '';
            climateSelect.value = '';
            continentSelect.value = '';
            checkBtn.style.display = 'inline-block';
            nextBtn.style.display = 'none';
            animalImageContainer.classList.add('visible');
            startTimer();
        }, 500);
    }
    
    function startTimer() {
        clearInterval(timer); // Biztons√°gi okokb√≥l t√∂rli az el≈ëz≈ë id≈ëz√≠t≈ët
        timeLeft = 20;
        timerDisplay.textContent = `Time left: ${timeLeft}`;
        progress.style.transition = 'none';
        progress.style.width = '100%';
        
        setTimeout(() => {
            progress.style.transition = 'width 20s linear';
            progress.style.width = '0%';
        }, 10);

        timer = setInterval(() => {
            timeLeft--;
            timerDisplay.textContent = `Time left: ${timeLeft}`;
            if (timeLeft <= 0) {
                clearInterval(timer);
                checkAnswer(true);
            }
        }, 1000);
    }

    function checkAnswer(timeout = false) {
        clearInterval(timer);
        progress.style.transition = 'none';
        let roundScore = 0;
        const selectedClimate = climateSelect.value;
        const selectedContinent = continentSelect.value;
        const correctClimates = currentAnimal['Kl√≠ma'].split(', ').map(c => c.trim());
        const correctContinents = currentAnimal['Kontinens'].split(', ').map(c => c.trim());

        let feedbackText = '';
        if (!timeout) {
            if (correctClimates.includes(selectedClimate)) {
                roundScore++;
            }
            if (correctContinents.includes(selectedContinent)) {
                roundScore++;
            }
            score += roundScore;
            scoreDisplay.textContent = `Score: ${score}`;

            if (roundScore === 2) {
                feedbackText = 'üéâ Perfect! You got 2 points! üéâ';
            } else if (roundScore === 1) {
                feedbackText = `üëç You got 1 point. The correct answer is Climate: ${correctClimates.join(', ')} and Continent: ${correctContinents.join(', ')}`;
            } else {
                feedbackText = `üò¢ Incorrect. The correct answer is Climate: ${correctClimates.join(', ')} and Continent: ${correctContinents.join(', ')}`;
            }
        } else {
            feedbackText = `‚è∞ Time's up! The correct answer is Climate: ${correctClimates.join(', ')} and Continent: ${correctContinents.join(', ')}`;
        }
        feedback.innerHTML = feedbackText;
        checkBtn.style.display = 'none';
        nextBtn.style.display = 'inline-block';
    }

    // √öJ R√âSZ: CSV feldolgoz√°sa √©s a j√°t√©k inicializ√°l√°sa
    
    /**
     * Beolvas egy CSV sz√∂veget √©s objektumok t√∂mbj√©v√© alak√≠tja.
     * Kezeli az id√©z≈ëjelek k√∂z√© tett, vessz≈ëket tartalmaz√≥ mez≈ëket is.
     * @param {string} text - A CSV form√°tum√∫ sz√∂veg.
     * @returns {Array<Object>} - Az adatok objektumok t√∂mbjek√©nt.
     */
    function parseCSV(text) {
        const result = [];
        const lines = text.trim().split('\n');
        const headers = lines.shift().split(',').map(h => h.trim());
        
        lines.forEach(line => {
            const obj = {};
            // Regex, ami a vessz≈ëk ment√©n bont, de figyelmen k√≠v√ºl hagyja az id√©z≈ëjelek k√∂z√∂tti vessz≈ëket
            const values = line.match(/(".*?"|[^",]+)(?=\s*,|\s*$)/g) || [];
            
            headers.forEach((header, i) => {
                if (values[i]) {
                    // Elt√°vol√≠tja az id√©z≈ëjeleket az √©rt√©k elej√©r≈ël √©s v√©g√©r≈ël
                    obj[header] = values[i].replace(/^"|"$/g, '').trim();
                } else {
                    obj[header] = '';
                }
            });
            result.push(obj);
        });
        return result;
    }

    /**
     * A j√°t√©kot elind√≠t√≥ f≈ë f√ºggv√©ny.
     * Aszinkron m√≥don bet√∂lti az adatokat a CSV f√°jlb√≥l, majd elind√≠tja a j√°t√©kot.
     */
    async function initializeGame() {
        try {
            const response = await fetch('animals.csv');
            if (!response.ok) {
                throw new Error('H√°l√≥zati hiba: ' + response.statusText);
            }
            const csvText = await response.text();
            gameData = parseCSV(csvText);

            // A j√°t√©k ind√≠t√°sa, miut√°n az adatok bet√∂lt≈ëdtek
            availableAnimals = [...gameData];
            shuffleArray(availableAnimals);
            loadAnimal();

            // Esem√©nykezel≈ëk hozz√°rendel√©se
            checkBtn.addEventListener('click', () => checkAnswer());
            nextBtn.addEventListener('click', loadAnimal);

        } catch (error) {
            console.error('Hiba t√∂rt√©nt a j√°t√©k adatainak bet√∂lt√©se k√∂zben:', error);
            document.getElementById('game-container').innerHTML = '<h1>Hiba a j√°t√©kadatok bet√∂lt√©sekor. K√©rlek, ellen≈ërizd, hogy az `animals.csv` f√°jl l√©tezik-e!</h1>';
        }
    }

    // A j√°t√©k elind√≠t√°sa
    initializeGame();

</script>

</body>
</html>